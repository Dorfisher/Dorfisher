<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>popculture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #f5f7ff 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }

        .logo {
            font-size: 4rem;
            font-weight: 900;
            font-family: 'Brush Script MT', 'Segoe Script', 'Lucida Handwriting', cursive;
            background: linear-gradient(45deg, #e63946, #ff6b35, #d4a843, #2d6a4f, #4361ee, #7209b7, #e63946);
            background-size: 500% 500%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient 15s ease infinite;
            text-transform: lowercase;
            letter-spacing: -1px;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .tagline {
            font-size: 1.1rem;
            color: #666;
            margin-top: 0.5rem;
            font-weight: 300;
            font-family: 'Assistant', 'Heebo', 'Alef', 'Segoe UI', Arial, sans-serif;
        }

        .post-card {
            background: transparent;
            backdrop-filter: none;
            border-radius: 20px;
            padding: 0;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.15);
            overflow: hidden;
        }

        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.15);
        }

        .post-header {
            background: rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem 2.5rem 1.5rem 2.5rem;
            margin: 0;
            border-radius: 20px 20px 0 0;
        }

        .post-body {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem 2.5rem 2.5rem 2.5rem;
            margin: 0;
            border-radius: 0 0 20px 20px;
        }

        .post-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .post-date {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .post-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #444;
        }

        .post-content p {
            margin-bottom: 1.2rem;
        }

        .collapsed-posts {
            margin-top: 3rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #444;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .collapsed-post {
            background: rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 1rem;
            border: 1px solid rgba(102, 126, 234, 0.15);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .collapsed-post:hover {
            background: rgba(102, 126, 234, 0.15);
            transform: translateX(5px);
        }

        .collapsed-header {
            padding: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collapsed-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .collapsed-date {
            color: #666;
            font-size: 0.9rem;
            font-weight: 400;
        }

        .expand-icon {
            color: #667eea;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .collapsed-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .collapsed-content.expanded {
            max-height: 1000px;
        }

        .collapsed-content .post-content {
            padding: 2rem;
            margin: 0;
        }

        .expanded .expand-icon {
            transform: rotate(180deg);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .logo {
                font-size: 2.5rem;
            }
            
            .post-card {
                padding: 1.5rem;
            }
            
            .post-title {
                font-size: 1.8rem;
            }
            
            .collapsed-header {
                padding: 1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 107, 107, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0);
            }
        }

        /* Hebrew RTL Support */
        .rtl {
            direction: rtl;
            text-align: right;
            font-family: 'Assistant', 'Heebo', 'Alef', 'Segoe UI', Arial, sans-serif;
        }

        .rtl .post-header {
            text-align: right;
        }

        .rtl .post-title {
            text-align: right;
        }

        .rtl .post-date {
            text-align: right;
        }

        .rtl .post-content {
            text-align: right;
        }

        .rtl .post-content p {
            text-align: right;
        }

        .rtl .collapsed-header {
            flex-direction: row-reverse;
        }

        .rtl .collapsed-title {
            text-align: right;
        }

        .rtl .collapsed-date {
            text-align: right;
        }

        .rtl .collapsed-content .post-content {
            text-align: right;
        }

        .rtl .section-title {
            text-align: center;
        }

        @media (max-width: 768px) {
            .rtl .collapsed-header {
                flex-direction: column;
                align-items: flex-end;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="logo">popculture</h1>
            <p class="tagline"></p> 
            // כותרת משנה
        </header>

        <main>
            <!-- Latest Post -->
            <article class="post-card" id="latest-post">
                <div class="post-header">
                    <h2 class="post-title">Loading...</h2>
                    <div class="post-date">Please wait</div>
                </div>
                <div class="post-body">
                    <div class="post-content">
                        <p>Loading your latest post...</p>
                    </div>
                </div>
            </article>

            <!-- Older Posts Section -->
            <section class="collapsed-posts">
                <h3 class="section-title">Previous Posts</h3>
                <!-- Posts will be loaded dynamically from posts.json -->
            </section>
        </main>
    </div>

    <script>
        // Global variables
        let allPosts = [];

        // Hebrew detection function
        function isHebrew(text) {
            // Hebrew Unicode range: \u0590-\u05FF
            const hebrewRegex = /[\u0590-\u05FF]/;
            return hebrewRegex.test(text);
        }

        // Detect if content is primarily Hebrew
        function isPrimaryLanguageHebrew(content) {
            // Remove HTML tags for text analysis
            const textOnly = content.replace(/<[^>]*>/g, '');
            const hebrewChars = (textOnly.match(/[\u0590-\u05FF]/g) || []).length;
            const totalChars = textOnly.replace(/\s/g, '').length;
            
            // If more than 30% of characters are Hebrew, consider it Hebrew content
            return totalChars > 0 && (hebrewChars / totalChars) > 0.3;
        }

        function togglePost(header) {
            const post = header.parentElement;
            const content = post.querySelector('.collapsed-content');
            const icon = header.querySelector('.expand-icon');
            
            post.classList.toggle('expanded');
            
            if (post.classList.contains('expanded')) {
                content.classList.add('expanded');
            } else {
                content.classList.remove('expanded');
            }
        }

        // Parse date string into Date object for sorting
        function parseDate(dateString) {
            return new Date(dateString);
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Clean HTML content from Word documents
        function cleanWordHTML(html) {
            // Remove Word-specific tags and attributes
            let cleaned = html
                .replace(/<o:p\s*\/?>/gi, '')
                .replace(/<\/o:p>/gi, '')
                .replace(/<w:.*?>/gi, '')
                .replace(/<\/w:.*?>/gi, '')
                .replace(/class="MsoNormal"/gi, '')
                .replace(/style="[^"]*"/gi, '')
                .replace(/<span[^>]*>\s*<\/span>/gi, '')
                .replace(/<p[^>]*>\s*<\/p>/gi, '')
                .replace(/&nbsp;/gi, ' ');

            // Extract just the body content if it exists
            const bodyMatch = cleaned.match(/<body[^>]*>(.*?)<\/body>/is);
            if (bodyMatch) {
                cleaned = bodyMatch[1];
            }

            // Clean up extra whitespace and empty tags
            cleaned = cleaned
                .replace(/\s+/g, ' ')
                .replace(/<([^>]+)>\s*<\/\1>/gi, '')
                .trim();

            return cleaned;
        }

        // Load post content from HTML file
        async function loadPostContent(filename) {
            try {
                const response = await fetch(`posts/${filename}`);
                if (!response.ok) {
                    throw new Error(`Failed to load ${filename}`);
                }
                const html = await response.text();
                return cleanWordHTML(html);
            } catch (error) {
                console.error('Error loading post content:', error);
                return '<p>Error loading post content. Please check if the file exists in the posts folder.</p>';
            }
        }

        // Display the latest post
        async function displayLatestPost(post) {
            const latestPostElement = document.getElementById('latest-post');
            const content = await loadPostContent(post.filename);
            
            // Check if content is Hebrew and apply RTL
            const isHebrewContent = isPrimaryLanguageHebrew(post.title + ' ' + content);
            
            latestPostElement.innerHTML = `
                <div class="post-header">
                    <h2 class="post-title">${post.title}</h2>
                    <div class="post-date">${formatDate(post.date)}</div>
                </div>
                <div class="post-body">
                    <div class="post-content">${content}</div>
                </div>
            `;
            
            // Apply RTL class if Hebrew content detected
            if (isHebrewContent) {
                latestPostElement.classList.add('rtl');
            } else {
                latestPostElement.classList.remove('rtl');
            }
        }

        // Display older posts in collapsed format
        async function displayOlderPosts(posts) {
            const collapsedSection = document.querySelector('.collapsed-posts');
            const postsContainer = collapsedSection.querySelector('.section-title').nextElementSibling;
            
            // Clear existing posts
            while (postsContainer && postsContainer.classList.contains('collapsed-post')) {
                postsContainer.remove();
                postsContainer = collapsedSection.querySelector('.section-title').nextElementSibling;
            }

            // Add each older post
            for (const post of posts) {
                const content = await loadPostContent(post.filename);
                
                // Check if content is Hebrew
                const isHebrewContent = isPrimaryLanguageHebrew(post.title + ' ' + content);
                
                const postElement = document.createElement('div');
                postElement.className = 'collapsed-post';
                
                // Add RTL class if Hebrew content
                if (isHebrewContent) {
                    postElement.classList.add('rtl');
                }
                
                postElement.innerHTML = `
                    <div class="collapsed-header" onclick="togglePost(this)">
                        <div>
                            <h4 class="collapsed-title">${post.title}</h4>
                            <div class="collapsed-date">${formatDate(post.date)}</div>
                        </div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="collapsed-content">
                        <div class="post-content">${content}</div>
                    </div>
                `;
                
                collapsedSection.appendChild(postElement);
            }
        }

        // Load posts from posts.json
        async function loadPosts() {
            try {
                const response = await fetch('posts.json');
                if (!response.ok) {
                    throw new Error('posts.json not found');
                }
                
                const data = await response.json();
                allPosts = data.posts || [];
                
                if (allPosts.length === 0) {
                    showFallbackContent();
                    return;
                }

                // Sort posts by date (newest first)
                allPosts.sort((a, b) => parseDate(b.date) - parseDate(a.date));
                
                // Display latest post
                await displayLatestPost(allPosts[0]);
                
                // Display older posts if any exist
                if (allPosts.length > 1) {
                    const olderPosts = allPosts.slice(1);
                    await displayOlderPosts(olderPosts);
                } else {
                    // Hide the older posts section if only one post exists
                    document.querySelector('.collapsed-posts').style.display = 'none';
                }
                
            } catch (error) {
                console.error('Error loading posts:', error);
                showFallbackContent();
            }
        }

        // Show fallback content if posts.json doesn't exist
        function showFallbackContent() {
            console.log('Using fallback content - create posts.json to load your posts');
            // The HTML already contains fallback content, so we don't need to do anything
        }

        // Add intersection observer for animations
        function initializeAnimations() {
            const posts = document.querySelectorAll('.collapsed-post');
            
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);
            
            posts.forEach(post => {
                post.style.opacity = '0';
                post.style.transform = 'translateY(20px)';
                post.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(post);
            });
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            loadPosts().then(() => {
                // Re-initialize animations after posts are loaded
                setTimeout(initializeAnimations, 100);
            });
        });

        // Refresh posts (useful for development)
        function refreshPosts() {
            loadPosts();
        }

        // Search functionality (bonus feature)
        function searchPosts(query) {
            const filteredPosts = allPosts.filter(post => 
                post.title.toLowerCase().includes(query.toLowerCase()) ||
                post.excerpt?.toLowerCase().includes(query.toLowerCase())
            );
            return filteredPosts;
        }
    </script>
</body>
</html>
